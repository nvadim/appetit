function renderBasket(){$(".products-list.scroll-content").html(""),$(".basket-items-col .spinner").show(),$.ajax({dataType:"json",url:"/bitrix/components/bd/basket/component.php?action=getBasket",success:renderBasketItems})}function renderBasketItems(e){e.cashback&&(animateNumbers($(".basket-actions .bonuses-info span").first(),e.cashback),animateNumbers($(".checkout-footer .bonuses-info span").first(),e.cashback)),e.promo||e.discount?(void 0!==e.discount&&null!==e.discount?($(".basket-actions .order-discount span").first().parent().show(),animateNumbers($(".basket-actions .order-discount span").first(),e.discount),animateNumbers($(".checkout-footer .order-discount span").first(),e.discount),$(".checkout-footer .order-discount span").first().parent().show(),$(".basket-actions .order-total").find(".summary-label").hide(),$(".checkout-footer .order-total").find(".summary-label").hide(),$(".ot-cont").addClass("with-promo"),$(".checkout-footer").addClass("with-promo")):($(".basket-actions .order-discount span").first().parent().hide(),$(".checkout-footer .order-total").find(".summary-label").show(),$(".basket-actions .order-total").find(".summary-label").show(),$(".ot-cont").removeClass("with-promo"),$(".checkout-footer").removeClass("with-promo"),$(".checkout-footer .order-discount").hide(),$(".basket-actions .order-discount").hide()),e.promo?($(".basket-promo-code").val(e.promo).parent().addClass("filled ok"),$(".basket-promo-code").parent().find(".apply-code-btn").addClass("ok")):($(".basket-promo-code").val("").parent().removeClass("filled ok"),$(".basket-promo-code").parent().find(".apply-code-btn").removeClass("ok"))):($(".checkout-footer .order-discount").hide(),$(".basket-actions .order-discount").hide()),$(".basket .basket-view .products-list").html(""),$.tmpl("basketTemplate",e.products).appendTo(".basket .basket-view .products-list"),$(".basket-items-col .spinner").hide(),setTimeout(function(){$(".basket-item .change-amount-btn").off().on("click",function(e){e.preventDefault();var t=$(this).closest(".basket-item"),a=t.find(".buttons").find('input[type="hidden"]').val(),s=parseInt(a),i=t.data("id"),n=parseInt(t.data("price"));return $(this).hasClass("plus")?s++:s--,0==s&&(s=1),$.ajax({type:"post",data:{PRODUCT_ID:i,AMOUNT:s},dataType:"json",url:"/bitrix/components/bd/basket/component.php?action=changeAmount",success:function(e){var a=!1;$.each(e.products,function(e,s){"gift"==s.INDEX&&(a=!0),t=$('.basket-item[data-id="'+s.INDEX+'"]'),t.find(".buttons .amount").text(s.AMOUNT),t.find('.buttons input[type="hidden"]').val(s.AMOUNT),animateNumbers(t.find(".product-sum span").first(),s.LOCAL_SUM.replace(" ",""))});var s=$('.basket-item[data-id="gift"]');s.length>0&&!a&&(s.remove(),$(".get-another-gift-btn").length&&$(".get-another-gift-btn").trigger("click")),renderSummary(e)}}),!1}),$(".remove-basket-item").off().on("click",function(e){$(".constructor-view").is(":visible")&&$(".constructor-view .close-view").trigger("click"),e.preventDefault();var t=$(this).closest(".basket-item"),a=t.attr("data-id");return"gift"==a&&$(".get-another-gift-btn").length?$(".get-another-gift-btn").trigger("click"):($('.product[data-id="'+t.attr("data-pid")+'"]').find(".add-to-cart-btn").removeClass("retry").text(BX.message("add_basket")),$.ajax({type:"post",data:{PRODUCT_ID:a},dataType:"json",url:"/bitrix/components/bd/basket/component.php?action=remove",success:function(e){var a=!1;$.each(e.products,function(e,t){"gift"==t.INDEX&&(a=!0),t.ID.indexOf("additional_")!==-1&&($('.basket_item_is_additional[data-id="'+t.ID+'"] .buttons').find(".amount").text(t.AMOUNT),$('.basket_item_is_additional[data-id="'+t.ID+'"] .buttons').find('input[type="hidden"]').val(t.AMOUNT))}),t.remove();var s=$('.basket-item[data-id="gift"]');s.length>0&&!a&&(s.remove(),$(".get-another-gift-btn").length&&$(".get-another-gift-btn").trigger("click")),renderSummary(e)}})),!1}),$(".basket-item .name,.basket-item .product-image").off().on("click",function(){if(!$(this).closest(".basket-item").hasClass("without_detail")){$(window).scrollTop(0);var e=$(this).closest(".basket-item").data("id");$.ajax({type:"post",data:{PRODUCT_ID:e},dataType:"json",url:"/bitrix/components/bd/basket/component.php?action=getBasketItemDetail",success:function(t){if($(".basket-view .status-bar .title").html(t.NAME),$(".information-col .close-view").show(),$(".information-col .apply-view").hide(),$(".product-info-cont .constructor-view .product-image img").attr("src",t.PREVIEW_PICTURE_M.src),$(".product-info-cont .constructor-view .name").attr("data-id",e).html(),"native"==t.TYPE){if($(".product-info-cont .like-content span").text(t.LIKE_COUNTER),$(".basket-view.change-view .product-description").text(t.PREVIEW_TEXT),$(".product-info-cont .likes").attr("data-id",t.ID).show(),1==t.isLiked?$(".product-info-cont .likes").addClass("liked"):$(".product-info-cont .likes").removeClass("liked"),$(".basket .change-view .product-options").html(""),null!=t.OPTIONS){var a=0;$.each(t.BD_PROPS,function(e,s){var i='<div class="options-row-select col-xl-'+parseInt(12/parseInt(t.BD_PROPS.length))+' col-lg-12"><select data-placeholder-option="true">';i+='<option value="null">'+t.OPTIONS_NAME[a+1]+"</option>",$.each(s,function(e,s){var n="";0==a&&e==parseInt(t.OPTIONS.OPTION_1)&&(n='selected="selected"'),1==a&&e==parseInt(t.OPTIONS.OPTION_2)&&(n='selected="selected"'),i+="<option "+n+' value="'+e+'" data-price="'+s.PRICE+'" data-old-price="'+s.OLD_PRICE+'" data-weight="'+s.WEIGHT+'">'+s.VALUE+"</option>"}),i+="</select></div>",$(".basket .change-view .product-options").append(i),a++}),$(".change-view .product-actions").show()}else $(".change-view .product-actions").hide();$(".basket .basket-view.change-view .apply-view").attr("disabled","disabled"),$(".basket .change-view .product-options select").on("change",function(){$(".basket .basket-view.change-view .apply-view").removeAttr("disabled")}).selectOrDie(),$(".basket .change-view .product-prices .weight").text(t.G),registerLikes(),$(".product-info-cont .constructor-view .constructor-scroll-content").hide(),$(".product-info-cont .constructor-view .product-scroll-content").show()}else $(".basket-view .back").attr("onclick","backToBasket()"),$(".product-detail-cont").show(),$(".product-info-cont .likes").hide(),$(".product-info-cont .constructor-content .ingredients_list_").html(""),$(".product-info-cont .constructor-content .base_value_").text(t.BASE),$(".product-info-cont .constructor-content .souse_value_").text(t.SOUSE),$.each(t.INGREDIENTS,function(e,t){$(".product-info-cont .constructor-content .ingredients_list_").append('<div class="property-value">'+t+"</div>")}),$(".product-info-cont .constructor-view .constructor-scroll-content").last().show(),$(".change-view .product-actions").hide();$(".product-info-cont").show(),$(".basket-view.main-view").hide()}})}})},1e3),renderSummary(e)}function registerLikes(){$(".likes").length&&$(".likes").off("click").on("click",function(e){e.preventDefault();var t=$(this).closest(".preview");0==t.length&&(t=$(this)),0!=window.user_id&&($(this).hasClass("liked")?$(this).removeClass("liked"):$(this).addClass("liked"));var a=$(this).closest(".product").data("id");return void 0==a&&(a=$(this).attr("data-id")),$.ajax({type:"post",data:{PRODUCT_ID:a},dataType:"json",url:"/?action=likeItem",success:function(e){t.find(".like-content span").text(e)}}),!1})}function renderSummary(e){0==e.products.length&&($(".close-basket").hide(),$(".basket-toggle svg").show(),$(".basket-header-sum span").first().text(0).parent().hide(),$(".basket-toggle").removeClass("active_"),$(".basket.basket-p").hide(),$("#page").show(),$(".header .title span").text(window.default_title).show(),$(".header .title img").show());var t=parseInt($(".min-order-progress").data("min-order"));if(e.basket_sum>t?($(".send-order").length&&$(".send-order").removeAttr("disabled"),$(".min-order-progress").hide(),$(".min-order-progress").find(".progress-bar").css("width","100%"),$(".checkout-btn").css("display","block")):($(".send-order").attr("disabled","disabled"),$(".min-order-progress").show(),$(".min-order-progress").find(".progress-bar").css("width",parseInt(e.basket_sum/t*100)+"%"),$(".checkout-btn").css("display","none")),e.products.length>0){if(0==e.basket_sum&&(isNaN(parseInt($('[name="ORDER[DISCOUNT_BONUSES]"]').val())+e.basket_sum-window.prev_delta)||$('[name="ORDER[DISCOUNT_BONUSES]"]').val(parseInt($('[name="ORDER[DISCOUNT_BONUSES]"]').val())+e.basket_sum-window.prev_delta),window.prev_delta=0,parseInt($('[name="ORDER[DISCOUNT_BONUSES]"]').val())+e.basket_sum>t&&$(".send-order").removeAttr("disabled")),e.basket_sum<0&&($('[name="ORDER[DISCOUNT_BONUSES]"]').val(parseInt($('[name="ORDER[DISCOUNT_BONUSES]"]').val())+e.basket_sum),window.prev_delta=e.basket_sum,e.basket_sum=0,$(".send-order").removeAttr("disabled")),parseInt($('[name="ORDER[DISCOUNT_BONUSES]"]').val())+e.basket_sum>0&&$(".send-order").removeAttr("disabled"),animateNumbers($(".basket-header-sum span").first(),e.basket_sum),$(".basket").is(":visible")||($(".basket-header-sum").show(),e.products.length>0?$(".basket-toggle").addClass("active_").find("svg").hide():$(".basket-toggle").removeClass("active_").find("svg").show()),animateNumbers($(".basket-actions .bonuses-info span").first(),e.cashback),animateNumbers($(".checkout-footer .bonuses-info span").first(),e.cashback),void 0!==e.promo&&$(".bonuses-with-promo-disabled").length?($(".bonuses-with-promo-disabled").show(),$(".checkout-footer .bonuses-info .default-text").hide(),$(".basket-actions .bonuses-info .default-text").hide()):($(".bonuses-with-promo-disabled").hide(),$(".checkout-footer .bonuses-info .default-text").show(),$(".basket-actions .bonuses-info .default-text").show()),animateNumbers($(".not-empty-basket").find(".basket-sum span").first(),e.basket_sum),animateNumbers($(".basket-actions .order-sum span").first(),e.basket_sum),animateNumbers($(".checkout-footer .order-sum span").first(),e.basket_sum),e.basket_sum_gift>window.limit1){var a=!1;for(prod in e.products)"gift"==e.products[prod].INDEX&&(a=!0);$(".gift-progress").hide(),1==a?$(".gift-progress-complete a").html(BX.message("get_another_gift")).parent().show().addClass("reuse"):$(".gift-progress-complete a").html(BX.message("get_gift")).parent().show().removeClass("reuse").addClass("use")}else{var s=parseInt(e.basket_sum_gift/window.limit1*100);$(".gift-progress").show().find(".progress-bar").css("width",s+"%"),animateNumbers($(".gift-progress .sum-to-gift span").first(),window.limit1-e.basket_sum_gift),$(".gift-progress-complete").hide(),$(".gift-progress").show()}if(!$(".product-info-cont").is(":visible")&&($(".recommendation-container.no-recommendation").show(),$(".recommendation-container.recommendation-list .rc-list").html(""),$(".recommendation-container.recommendation-list .rc-nav").html(""),$(".recommendation-container.static-banner").show().html(""),void 0===e.recommendation.single||void 0!=e.recommendation.list&&0!=e.recommendation.list.length||($(".recommendation-container.no-recommendation").hide(),$(".recommendation-container.recommendation-list").hide(),$(".recommendation-container.static-banner").html('<a href="'+e.recommendation.single.URL+'"><img src="'+e.recommendation.single.IMAGE.SRC+'" /></a>').show()),void 0!==e.recommendation.list&&null!==e.recommendation.list&&e.recommendation.list.length>0)){$(".recommendation-container.no-recommendation").hide(),$(".recommendation-container.static-banner").hide(),$(".recommendation-container.recommendation-list").show();for(var i=Math.ceil(e.recommendation.list.length/3),n=0;n<i;n++){var o="";$(".recommendation-container.recommendation-list .rc-list").append('<div class="recommendation-tab" data-index="'+(n+1)+'"></div>'),i>1&&(0==n&&(o='class="active"'),$(".recommendation-container.recommendation-list .rc-nav").append("<li "+o+'><a href="#" data-index="'+(n+1)+'"><div class="rc-bull"></div></a></li>'))}$.each(e.recommendation.list,function(e,t){var a="";void 0!==t.IMAGE.SRC&&(a="background-image: url("+t.IMAGE.SRC+");"),$('.recommendation-container.recommendation-list .rc-list .recommendation-tab[data-index="'+Math.ceil((e+1)/3)+'"]').append('<div class="rc-item" style="background-color: '+t.PROPERTY_BG_COLOR_VALUE+";"+a+'"><a href="'+t.URL+'" class="go-rc-btn" style="color: '+t.PROPERTY_BUTTON_FONT_COLOR_VALUE+";background-color: "+t.PROPERTY_BUTTON_COLOR_VALUE+';">'+t.NAME+"</a></div>")}),$(".recommendation-container.recommendation-list .rc-nav li a").off().on("click",function(e){return $(".recommendation-container.recommendation-list .rc-nav li").removeClass("active"),$(this).parent().addClass("active"),e.preventDefault(),$(".recommendation-container.recommendation-list .recommendation-tab").hide(),$('.recommendation-container.recommendation-list .recommendation-tab[data-index="'+$(this).attr("data-index")+'"]').show(),!1})}}else $("body").trigger("click"),$(".basket-sum span").first().text(0),$(".empty-basket").show(),$(".not-empty-basket").hide();$(".gift-sticky").length&&calcGifts(e.basket_sum_gift)}function getConstructorView(e){$(".constructor-view").hide(),$(".constructor-view."+e+"-view").show(),"ingredient-list"==e&&$(".back").attr("onclick",'getConstructorView("add-ingredient")'),"main"==e&&($(".back").attr("onclick",'window.location.href="/catalog/"'),$(".status-bar .title").text(BX.message("wok_box_title"))),"base"==e&&($(".status-bar .title").text(BX.message("wok_base")),$(".back").attr("onclick",'getConstructorView("main")')),"souse"==e&&($(".status-bar .title").text(BX.message("wok_souce")),$(".back").attr("onclick",'getConstructorView("main")')),"presets"==e&&($(".status-bar .title").text(BX.message("wok_ready_box")),$(".back").attr("onclick",'getConstructorView("main")')),"add-ingredient"==e&&($(".status-bar .title").text(BX.message("wok_ingredients")),$(".back").attr("onclick",'getConstructorView("main")'))}function getCheckoutView(e){$(".checkout-view").hide(),$(".checkout-view."+e+"-view").show(),"main"==e?($(".status-bar").hide(),$(window).scrollTop(window.order_scroll)):($(".status-bar").show(),"my-adresses"==e&&$(".status-bar .title").text(BX.message("choise_address")),"payment-type"==e&&$(".status-bar .title").text(BX.message("type_delivery")),"set-pickup"==e&&$(".status-bar .title").text(BX.message("takeaway")),"new-address"==e&&$(".status-bar .title").text(BX.message("address_delivery")),"delivery-regions"==e&&$(".status-bar .title").text(BX.message("destrict")),"order-date"==e&&$(".status-bar .title").text(BX.message("choise_date"))),"my-adresses"!=e&&"payment-type"!=e&&"new-address"!=e&&"order-date"!=e&&"set-pickup"!=e||$(".back").attr("onclick",'getCheckoutView("main")'),"delivery-regions"==e&&$(".back").attr("onclick",'getCheckoutView("new-address")')}function getProfileView(e){$(".profile-view").hide(),$(".profile-view."+e+"-view").show(),"districts"==e?$(".back").attr("onclick","getProfileView('address')"):$(".back").attr("onclick","getProfileView('personal')").attr("data-target-title",BX.message("ls")),"address"==e&&$(".status-bar .title").text($(".address-view").find('input[name="ADDRESS[NAME]"]').val()||BX.message("ls")),"personal"==e&&($(".status-bar .title").text(BX.message("ls")),$(".back").attr("onclick","openMainProfileNav()")),$(".history-view").length&&(e.indexOf("order")!==-1?($(".back").attr("onclick","getProfileView('history')").attr("data-target-title",BX.message("history")),$(".status-bar .title").text($("."+e+"-view").data("target-title"))):$(".back").attr("onclick","openMainProfileNav()"),"history"==e&&$(".status-bar .title").text(BX.message("history")))}function animateNumbers(e,t){$({val_i:parseInt($(e).text().split(" ").join(""))}).animate({val_i:parseInt(t)},{duration:500,easing:"swing",step:function(){$(e).text(number_format(this.val_i,0,"."," "))},complete:function(){$(e).text(number_format(t,0,"."," "))}})}function number_format(e,t,a,s){var i,n,o,r,d;return isNaN(t=Math.abs(t))&&(t=2),void 0==a&&(a=","),void 0==s&&(s="."),i=parseInt(e=(+e||0).toFixed(t))+"",o=i.split(/(?=(?:\d{3})+$)/).join(s),r=t?a+Math.abs(e-i).toFixed(t).replace(/-/,0).slice(2):"",o+r}function validateProperties(e){var t=[];return e.find("select").length?e.find("select").each(function(e,a){null==$(a).val()||"null"==$(a).val().toString()?(t.push(!1),$(a).closest(".sod_select").addClass("error_ shake"),setTimeout(function(){$(a).closest(".sod_select").removeClass("shake")},1500)):(t.push(!0),$(a).closest(".sod_select").removeClass("error_ shake"))}):t.push(!0),t.indexOf(!1)===-1}function registerProductListeners(){0==window.user_id&&$(".likes").length>0&&$(".likes").addClass("guest-likes"),$(".basket .change-view .apply-view").off().on("click",function(e){e.preventDefault();var t={};return 1==$(".basket .change-view  .product-options select").length&&(t.OPTION_1=$(".basket .change-view  .product-options select").first().val()),2==$(".basket .change-view  .product-options select").length&&(t.OPTION_1=$(".basket .change-view  .product-options select").first().val(),t.OPTION_2=$(".basket .change-view  .product-options select").last().val()),$.ajax({type:"post",data:{PRODUCT_ID:$(".basket .change-view  .name").attr("data-id"),OPTIONS:t},dataType:"json",url:"/bitrix/components/bd/basket/component.php?action=updateOptions",success:function(e){$(".basket .basket-view.change-view").hide(),renderBasket()}}),!1}),$(".product select").off().on("change",function(){var e=$(this).closest(".product"),t=$(this).closest(".product").find(".product-prices"),a=1;$(this).closest(".options-row-select").hasClass("options-length-2")&&(a=2);var s,i,n;s=parseInt(e.find("select").first().find("option:selected").data("price")),i=parseInt(e.find("select").first().find("option:selected").data("old-price")),n=parseInt(e.find("select").first().find("option:selected").data("weight")),2==a&&(s+=parseInt(e.find("select").last().find("option:selected").data("price")),isNaN(parseInt(e.find("select").last().find("option:selected").data("old-price")))||(i+=parseInt(e.find("select").last().find("option:selected").data("old-price"))),n+=parseInt(e.find("select").last().find("option:selected").data("weight"))),isNaN(s)||t.find(".current-price span").first().text(number_format(s,0,"."," ")),isNaN(i)?(e.find(".product-footer").addClass("base-price"),t.find(".old-price").hide()):(e.find(".product-footer").removeClass("base-price"),t.find(".old-price .line-through").text(number_format(i,0,"."," ")).parent().show()),isNaN(n)||t.find(".weight").find("span").first().text(n),$(this).selectOrDie("update")}),$(".product-actions .add-to-cart-btn").off().on("click",function(e){if(!$(".lic").length){if($(this).closest(".product-actions").hasClass("progress-complete"))return!1;void 0!=window.yaCounter&&null!=window.yaCounter&&yaCounter.reachGoal("add-to-basket",{}),void 0!=ga&&ga("send","event","basket","add"),e.preventDefault();var t=$(this),a={};1==t.closest(".product").find("select").length&&(a.OPTION_1=t.closest(".product").find("select").first().val()),2==t.closest(".product").find("select").length&&(a.OPTION_1=t.closest(".product").find("select").first().val(),a.OPTION_2=t.closest(".product").find("select").last().val());var s=t.closest(".product");if(validateProperties(s)){var i=$(".basket-btn-container");$.ajax({type:"post",data:{PRODUCT_ID:t.data("id"),options:a},dataType:"json",url:"/bitrix/components/bd/basket/component.php?action=addToBasket",success:function(e){renderBasket()}}),$('.product[data-id="'+t.data("id")+'"]').find(".add-to-cart-btn").addClass("retry").text(BX.message("get_more")),t.hasClass("retry")||t.addClass("retry").text(BX.message("get_more"))}return!1}})}function setAuthState(e){$(".header .title span").text(BX.message("auth_text")).show(),$(".auth-state").hide(),$(".auth-state."+e).show(),"forgot-password-state"==e||"phone-confirm-password-state"==e||"set-new-password-state"==e||"phone-confirm-password-state"==e||"set-new-password-state"==e||"agreement-state"==e?($(".auth-tabs").hide(),$(".auth-status-bar .back").show(),$(".auth-status-bar").css("height","48px")):($(".auth-status-bar .back").hide(),$(".auth-tabs").show(),$(".auth-status-bar").css("height","70px")),$(".status-bar .title").text("");var t=window.auth_type;"forgot-password-state"==e&&("sms"==t&&(t="default"),$(".status-bar .title").text(BX.message("forgot_password")),$(".status-bar .back").attr("onclick",'setAuthState("sign-in-'+t+'-state")')),"agreement-state"==e&&("sms"==t&&(t="phone"),$(".status-bar .title").text(BX.message("agree_license")),$(".status-bar .back").attr("onclick",'setAuthState("sign-up-'+t+'-state")'))}function checkPromoAjax(){var e=$(".basket-promo-code"),t=e.val();$.ajax({type:"post",data:{CODE:t},dataType:"json",url:"/bitrix/components/bd/basket/component.php?action=checkPromo",success:function(t){1==t.status&&(e.closest(".bd-input").removeClass("error").addClass("ok"),e.parent().find(".apply-code-btn").addClass("ok"),$(".ot-cont").addClass("with-promo")),0==t.status&&(e.closest(".bd-input").removeClass("ok").addClass("error"),e.parent().find(".apply-code-btn").removeClass("ok"),$(".ot-cont").removeClass("with-promo")),renderBasket(),$('select[name="ORDER[DISTRICT_ID]"]').length&&$('select[name="ORDER[DISTRICT_ID]"]').trigger("change")}})}function removeFromConstructor(e){"true"==$('.constructor-ingredient-basket-item[data-id="'+e+'"]').attr("data-auto")&&$("#constructor_form").append('<input type="hidden" name="EXCLUDE_AUTO[]" value="'+e+'" />'),$('input[name="INGREDIENTS[]"][value="'+e+'"]').remove(),$('.constructor-ingredient-basket-item[data-id="'+e+'"]').remove(),$('.ingredient-item[data-id="'+e+'"]').removeClass("active")}function validateConstructor(){return $('[name="BASE_ID"]').val().trim().length>0&&$('[name="SOUSE_ID"]').val().trim().length>0?($(".add-to-cart-constructor").removeAttr("disabled"),!0):($(".add-to-cart-constructor").attr("disabled","disabled"),!1)}function calculateConstructor(){$.ajax({type:"post",data:$("#constructor_form").serialize(),dataType:"json",url:"/bitrix/components/bd/constructor/component.php?action=calculateConstructor",success:function(e){validateConstructor(),null!=e.INGREDIENTS&&($(".ingredients-list").html(""),$.tmpl("constructorIngredientBasketTemplate",e.INGREDIENTS).appendTo(".ingredients-list"),$.each(e.INGREDIENTS,function(e,t){0==$('input[name="INGREDIENTS[]"][value="'+t.ID+'"]').length&&($("#constructor_form").append('<input type="hidden" name="INGREDIENTS[]" value="'+t.ID+'">'),$('.ingredient-item[data-id="'+t.ID+'"]').addClass("active"))}),registerIngredientChangeAmountListener()),parseInt(e.SUM)&&$(".clear-constructor").show(),$(".constructor-summary .sum-value span").first().text(e.SUM),$(".constructor-summary .weight span").first().text(e.WEIGHT),$('#constructor_form input[name="PRICE"]').val(e.SUM),$('#constructor_form input[name="WEIGHT"]').val(e.WEIGHT)}})}function registerIngredientChangeAmountListener(){$(".constructor-ingredient-basket-item .change-amount-btn").off().on("click",function(e){e.preventDefault();var t=$(this).closest(".constructor-ingredient-basket-item"),a=t.find(".buttons").find('input[type="hidden"]').val(),s=parseInt(a);return $(this).hasClass("plus")?s++:s--,0==s&&(s=1),t.find(".buttons").find('input[type="hidden"]').val(s),calculateConstructor(),!1}),$(".constructor-ingredient-basket-item .remove-basket-item a").off().on("click",function(e){return removeFromConstructor($(this).parent().data("id")),!1})}function plural(e,t,a,s){return e=Math.abs(e),e%=100,e>=5&&e<=20?s:(e%=10,1==e?t:e>=2&&e<=4?a:s)}function getProfileMainPage(){$(".profile-view.address-view").find('input[name="ADDRESS[ID]"]').val(""),$(".profile-view.address-view").find('input[name="ADDRESS[NAME]"]').val(""),$(".profile-view.address-view").find('input[name="ADDRESS[STREET]"]').val(""),$(".profile-view.address-view").find('input[name="ADDRESS[HOUSE]"]').val(""),$(".profile-view.address-view").find('input[name="ADDRESS[APARTMENT]"]').val(""),$(".profile-view.personal-view").show(),$(".profile-view.address-view").hide()}function getAddressForm(){$(".status-bar .back").attr("onclick",'getProfileView("personal")');var e=$(".profile-view.address-view");e.find('input[name="ADDRESS[ID]"]').val(""),e.find('input[name="ADDRESS[NAME]"]').val(""),e.find('input[name="ADDRESS[STREET]"]').val(""),e.find('input[name="ADDRESS[HOUSE]"]').val(""),e.find('input[name="ADDRESS[APARTMENT]"]').val(""),e.find('[name="ADDRESS[DISTRICT_ID]"]').val(""),$(".address-view .address-item").text(BX.message("change_destrict")),$(".profile-view.personal-view").hide(),$(".profile-view.address-view").show(),$(".districts-view .bd-row-checkbox").removeClass("active")}function calcGifts(e){$(".gift-item").length&&$(".gift-item").each(function(t,a){var s=parseInt($(a).find(".gift-progress-info").data("limit")),i=e/s*100;s>e?($(a).find(".gift-progress-value").text(s-e),$(a).find(".progress-container .progress-bar").css("width",i+"%"),$(a).find(".gift-progress-info").show(),$(a).find(".get-gift").hide()):($(a).find(".gift-progress-info").hide(),$(a).find(".get-gift").show())})}function backToBasket(){$(".basket-view").hide(),$(".basket-view.main-view").show()}function openMainProfileNav(){var e=$("#menu").data("mmenu");e.close(),$("#page").hide(),$(".profile-view.main-view").show().css("margin-top","50px"),$(".header a").removeClass("opened").html(""),$(".header .title span").text(BX.message("ls")).show()}function processAddress(){$(".delivery-type-tab-1 .config-item a").text($('[name="ORDER[STREET]"]').val()+BX.message("homee")+$('[name="ORDER[HOUSE]"]').val()+BX.message("appartaments")+$('[name="ORDER[APARTMENT]"]').val()),$(".back:visible").trigger("click")}function validateOrder(){var e=0;0==$('[name="ORDER[USER_NAME]"]').val().trim().length&&(e=1),0==$('[name="ORDER[USER_PHONE]"]').val().trim().length&&(e=1),0==$('[name="ORDER[PAYMENT_TYPE]"]').val().trim().length&&(e=1),0==$('[name="ORDER[DELIVERY_PICKUP_ID]"]').val().trim().length&&(0==$('[name="ORDER[DISTRICT_ID]"]').val().trim().length&&(e=1),0==$('[name="ORDER[STREET]"]').val().trim().length&&(e=1),0==$('[name="ORDER[HOUSE]"]').val().trim().length&&(e=1),0==$('[name="ORDER[APARTMENT]"]').val().trim().length&&(e=1)),console.log(e)}function validateAddress(){var e=0;0==$('[name="ORDER[STREET]"]').val().trim().length&&(e=1),0==$('[name="ORDER[HOUSE]"]').val().trim().length&&(e=1),0==$('[name="ORDER[APARTMENT]"]').val().trim().length&&(e=1),0==$('[name="ORDER[DISTRICT_ID]"]').val().trim().length&&(e=1),0==e?$(".new-address-view button").removeAttr("disabled"):$(".new-address-view button").attr("disabled","disabled")}Number.prototype.pad=function(e){for(var t=String(this);t.length<(e||2);)t="0"+t;return t},$(document).ready(function(){if(sbjs.init(),$.cookie("t_source",sbjs.get.current.typ+"|"+sbjs.get.current.src,{path:"/"}),$(".main-view").length&&(window.order_scroll=0,$(window).on("scroll",function(e){$(".main-view").is(":visible")&&(window.order_scroll=$(window).scrollTop())})),$(".carousel").length){var e=$(".carousel").flickity({cellAlign:"center",contain:!0,autoPlay:3e3,percentPosition:!1,prevNextButtons:!1});$(".bd-slider").css("opacity","1"),$(".slider-container .spinner").hide();var t=e.data("flickity");$($(".flickity-page-dots .dot")[t.selectedIndex]).addClass("completed"),e.on("select.flickity",function(){$(".flickity-page-dots .dot").removeClass("completed"),$($(".flickity-page-dots .dot")[t.selectedIndex]).addClass("completed")})}if($("#checkout-form input").on("keyup",function(){validateOrder()}),$(".delivery_time").mask("99:99"),$(".sub-categories-toggle").on("click",function(e){e.preventDefault();var t=$(this).closest("li");return t.hasClass("opened")?(t.removeClass("opened"),t.find("ul").slideUp()):(t.addClass("opened"),t.find("ul").slideDown()),!1}),$("#constructor_form").on("submit",function(e){e.preventDefault(),validateConstructor()&&$.ajax({type:"post",data:$("#constructor_form").serialize(),dataType:"json",url:"/bitrix/components/bd/basket/component.php?action=addToBasket",success:function(e){renderBasket(),$(".clear-constructor").trigger("click")}})}),$(".clear-constructor").on("click",function(e){return e.preventDefault(),$('[data-var-name="base"]').text(BX.message("wok_get_base")),$('[data-var-name="souse"]').text(BX.message("wok_get_souce")),$('[data-var-name="presets"]').text(BX.message("wok_get_ready_box")),$(this).hide(),$(".preset-item").removeClass("active"),$('input[name="INGREDIENTS[]"]').remove(),$('input[name="EXCLUDE_AUTO[]"]').remove(),$(".constructor-ingredient-basket-item").remove(),$(".constructor-item").removeClass("active"),$(".ingredient-item").removeClass("active"),$('input[name="BASE_ID"]').val(""),$('input[name="SOUSE_ID"]').val(""),$('input[name="WEIGHT"]').val(""),$('input[name="PRICE"]').val(""),$('input[name="IMAGE"]').val(window.template_path+"/images/constructor-image.jpg"),$('input[name="NAME"]').val(BX.message("wok_js_box")),$(".preset-image-big img").attr("src",window.template_path+"/images/constructor-image.jpg"),calculateConstructor(),!1}),$(".ingredient-item").on("click",function(e){$(e.target).hasClass("delete")||($(this).addClass("active"),0==$('input[name="INGREDIENTS[]"][value="'+$(this).data("id")+'"]').length&&$("#constructor_form").append('<input type="hidden" name="INGREDIENTS[]" value="'+$(this).data("id")+'"/>'),calculateConstructor())}),$(".ingredient-item .delete").on("click",function(e){$(this).closest(".ingredient-item").removeClass("active"),removeFromConstructor($(this).data("id"))}),registerProductListeners(),renderBasket(),registerLikes(),$('input[name="PHONE"],input[name="USER[PHONE]"],input[name="ORDER[USER_PHONE]"]').mask(window.phone_mask,{placeholder:" "}),$('input[name="USER[BIRTHDAY]"]').mask("99.99.9999",{placeholder:" "}),$('input[name="ORDER[DELIVERY_TIME]"],input[name="ORDER[DELIVERY_TIME_2]"]').mask("99:99",{placeholder:" "}),$(".carousel").length){var e=$(".carousel").flickity({cellAlign:"center",contain:!0,autoPlay:3e3,percentPosition:!1,prevNextButtons:!1});$(".bd-slider").css("opacity","1"),$(".slider-container .spinner").hide();var t=e.data("flickity");$($(".flickity-page-dots .dot")[t.selectedIndex]).addClass("completed"),e.on("select.flickity",function(){$(".flickity-page-dots .dot").removeClass("completed"),$($(".flickity-page-dots .dot")[t.selectedIndex]).addClass("completed")})}$("#menu").mmenu({transitionDuration:0,extensions:["theme-white","effect-listitems-slide","border-offset"],navbars:[{height:3,content:[window.top_navbar]},!0]},{});var a=$("#menu").data("mmenu");a.bind("openPanel",function(e){"catalog-panel"==e.attr("id")||e.hasClass("mm-vertical")?$("body").addClass("catalog-opened"):$("body").removeClass("catalog-opened")}),$(".login-trigger").on("click",function(e){e.preventDefault();var t=$("#menu").data("mmenu");t.close(),$(".auth-content").show(),$("#page").hide();var a="sign-in-default-state";return"email"==window.auth_type&&(a="sign-in-email-state"),$(".header a").removeClass("opened").html(""),setAuthState(a),$(window).scrollTop(0),!1}),$("#inp_agree").on("change",function(){var e=$(this).closest("form");$(this).is(":checked")?e.find("button").removeAttr("disabled"):e.find("button").attr("disabled","disabled")}),$(".auth-tabs li").on("click",function(e){e.preventDefault();var t="sign-in-default-state";"email"==window.auth_type&&(t="sign-in-email-state");var a="sign-up-phone-state";return"email"==window.auth_type&&(a="sign-up-email-state"),"sign-in"==$(this).attr("data-target")&&setAuthState(t),"sign-up"==$(this).attr("data-target")&&setAuthState(a),$(".auth-tabs li").removeClass("active"),$(this).addClass("active"),!1}),$(".auth-state form").on("submit",function(e){e.preventDefault();var t=$(this);return $('[name="PHONE"]').length>1&&"RESET_PASSWORD"!=$(this).find('[name="ACTION"]').val()&&$('[name="PHONE"]').val(t.find('[name="PHONE"]').val()).closest(".bd-input").addClass("filled"),$('[name="EMAIL"]').length>1&&"RESET_PASSWORD"!=$(this).find('[name="ACTION"]').val()&&$('[name="EMAIL"]').val(t.find('[name="EMAIL"]').val()).closest(".bd-input").addClass("filled"),
$('[name="PASSWORD"]').val(t.find('[name="PASSWORD"]').val()).closest(".bd-input").addClass("filled"),"RESET_PASSWORD"==$(this).find('[name="ACTION"]').val()&&($(".phone-confirm-password-state").find('[name="PHONE"]').val($(this).find('[name="PHONE"]').val()).closest(".bd-input").addClass("filled"),$(".set-new-password-state").find('[name="PHONE"]').val($(this).find('[name="PHONE"]').val()).closest(".bd-input").addClass("filled"),$(".phone-confirm-password-state").find('[name="EMAIL"]').val($(this).find('[name="EMAIL"]').val()).closest(".bd-input").addClass("filled"),$(".set-new-password-state").find('[name="EMAIL"]').val($(this).find('[name="EMAIL"]').val()).closest(".bd-input").addClass("filled")),$.ajax({type:"post",data:t.serialize(),dataType:"json",url:"/?action=auth",success:function(e){if(t.find(".bd-error").html(""),void 0!=e.ERRORS){$.each(e.ERRORS,function(e,a){t.find('input[name="'+a.FIELD+'"]').closest(".bd-input").addClass("error"),t.find(".bd-error").append("<div>"+a.MESSAGE+"</div>")});var a="#sms_reg";0==$("#sms_reg").length&&(a="#sign-up-email-form"),$(a+" .input-row-first .bd-input").hasClass("error")&&$(a+" .input-row .bd-input").hasClass("error")&&!$(a+" .input-row-last .bd-input").hasClass("error")?$(a+" .input-row-last").css("margin-top",0):($(a+" .input-row-last").css("margin-top","-1px"),$(a+" .input-row").css("margin-top","-1px")),$(a+" .input-row-first .bd-input").hasClass("error")&&!$(a+" .input-row .bd-input").hasClass("error")&&$(a+" .input-row-last .bd-input").hasClass("error")&&$(a+" .input-row").css("margin-top",0)}else"ERROR"==e.TYPE?t.find(".bd-error").html(e.MESSAGE).show():"auth-success"!==e.next?($(".auth-state").hide(),$(".auth-state."+e.next+"-state").show(),t.find(".bd-error").html("").hide()):window.location.reload()}}),!1}),$(".resend-cont").length&&$(".code-resend").on("click",function(e){e.preventDefault();var t=$(this).closest(".auth-info");return $.ajax({type:"post",data:{ACTION:"RESEND",PHONE:t.closest(".auth-state").find('input[name="PHONE"]').val()},dataType:"json",url:"/?action=auth",success:function(e){t.find(".resend-status").show(),t.find(".code-resend").hide(),t.find(".resend-status .timer").html("0:59");var a=59,s=setInterval(function(){a--,t.find(".resend-status .timer").html("0:"+a.pad()),0==a&&(clearInterval(s),t.find(".resend-status").hide(),t.find(".code-resend").show())},1e3)}}),!1});var s='<div class="row constructor-ingredient-basket-item"  data-id="${ID}" data-auto="${IS_AUTO}"> <div class="name-cont"> <div class="name">${NAME}</div> <div class="category">${SECTION}</div> <div class="weight"><span>${GRAMM}</span> '+BX.message("gramm")+'</div> </div> <div class="buttons"><a href="#" class="change-amount-btn minus">-</a><span class="amount">${AMOUNT}</span> <input type="hidden" name="ING_AMOUNT[${ID}]" value="${AMOUNT}"/><a href="#" class="change-amount-btn plus">+</a> </div> <div class="price-block"><span class="product-sum">${LOCAL_PRICE}<span class="currency">'+window.currencyFont+'</span></span></div> <div class="remove-basket-item"  data-id="${ID}"><a href="#"> <svg viewBox="0 0 38.0919 40.5429"><path class="cls-1" d="M35.1491,39.3951V60.8883a6.2561,6.2561,0,0,0,6.2366,6.2366H59.81a6.2549,6.2549,0,0,0,6.2366-6.2366V39.3951H35.1491ZM57.8477,31.016c-0.5913-5.912-13.9111-5.912-14.5019,0H33.838a2.2942,2.2942,0,0,0-2.2875,2.2868h0A2.2939,2.2939,0,0,0,33.838,35.59H67.3556a2.2938,2.2938,0,0,0,2.2868-2.2875h0a2.2941,2.2941,0,0,0-2.2868-2.2868h-9.508ZM43.9426,60.6523c-0.8815,0-1.5868-.3957-1.5868-0.89V45.9838c0-.4947.7053-0.8907,1.5868-0.8907s1.587,0.396,1.587.8907v13.778c0,0.4947-.7053.89-1.587,0.89h0Zm6.6539,0c-0.8817,0-1.587-.3957-1.587-0.89V45.9838c0-.4947.7053-0.8907,1.587-0.8907s1.5868,0.396,1.5868.8907v13.778c0,0.4947-.7053.89-1.5868,0.89h0Zm6.6551,0c-0.8817,0-1.587-.3957-1.587-0.89V45.9838c0-.4947.7053-0.8907,1.587-0.8907s1.5868,0.396,1.5868.8907v13.778C58.8383,60.2565,58.133,60.6523,57.2515,60.6523Z" transform="translate(-31.5505 -26.5819)"/></svg></a></div> </div>';$.template("constructorIngredientBasketTemplate",s);var i='<div class="basket-item row ${CLASSES}"  data-pid="${ID}" data-id="${INDEX}" data-price="${PRICE}"> <div class="product-image-cont"> <div class="product-image"><img src="${IMAGE}"><div class="${APPEND_WITHOUT_SALE}" title="'+BX.message("gramm")+'"></div></div> </div> <div class="name-cont"> <div class="name">${NAME}</div> <div class="buttons"><a href="#" class="change-amount-btn minus">-</a><span class="amount">${AMOUNT}</span> <input type="hidden" value="${AMOUNT}"><a href="#" class="change-amount-btn plus">+</a> </div> </div> <div class="remove-basket-item"><span>&times;</span></div> <div class="price-block"><span class="product-sum font-fix"><span>${LOCAL_SUM}</span><span class="currency">'+window.currencyFont+'</span></span></div> </div> <div class="clearfix"></div>';$.template("basketTemplate",i),window.default_title=$(".header .title span").text(),$(".use-bonuses button").on("click",function(e){$(this).closest(".use-bonuses").find(".bd-input").show()}),$(".header a").on("click",function(e){$("#menu").hasClass("mm-opened")?($(".mm-panels").hide(),a.close(),$(".header a").removeClass("opened").html(""),$(".header .title img").show(),$(".header .title span").hide(),$(".header .title span").text(window.default_title).show()):($(".mm-panels").show(),a.open(),$(".header a").addClass("opened").html("&times;"),$(".header .title img").hide(),$(".header .title span").text("����").show(),$(".basket").is(":visible")&&$(".basket-toggle").trigger("click"))}),$(".main-tabs").length&&($(".product-list").hide(),$(".product-list."+$(".main-tabs li.active a").data("target")).show(),$(".main-tabs li").on("click",function(e){return e.preventDefault(),$(".main-tabs li").removeClass("active"),$(this).addClass("active"),$(".product-list").hide(),console.log($(this).find("a").data("target")),$(".product-list."+$(this).find("a").data("target")).show(),!1})),$(".basket-toggle").on("click",function(e){$(".header a").removeClass("opened").text(""),e.preventDefault(),a.close(),$(window).scrollTop(0),0!==parseInt($(".basket-header-sum span").first().text())&&(!$(".basket.basket-p").is(":visible")&&$(this).hasClass("active_")?(backToBasket(),$(".basket-header-sum").hide(),$(".close-basket").show(),$(".basket-toggle").removeClass("active_"),$(".basket").show(),$("#page").hide(),$(".header .title span").text("�������").show(),$(".header .title img").hide()):($(".basket-toggle").addClass("active_"),$(".basket-header-sum").show(),$(".close-basket").hide(),$(".basket.basket-p").hide(),$("#page").show(),$(".header .title span").text(window.default_title).show(),$(".header .title img").show()))}),$(".new-address-view input").on("keyup",function(){validateAddress()}),$(".apply-code-btn").on("click",function(e){return checkPromoAjax(),!1}),$(".gender-toggle a").on("click",function(){$(".gender-toggle a").removeClass("active"),$(this).addClass("active"),$('[name="USER[GENDER]"]').val($(this).attr("id"))}),$("select").selectOrDie({placeholderOption:!0}),$(".filter-btn").length&&$(".filter-btn").on("click",function(e){e.preventDefault(),$(this).toggleClass("active"),$(".filter-cont").slideToggle(1),$(".product-list").slideToggle(1)}),$(".filter-param-item").length&&($(".filter-param-item .icon-param,.filter-param-item span").on("click",function(e){e.preventDefault();var t=$(this).parent(),a=$(this).closest(".filter-param-item"),s=$("#ingridients-filter form");return $(this).hasClass("selected")?(a.find('input[type="hidden"]').val("N"),$(this).removeClass("selected"),"SPAN"==$(this)[0].tagName&&a.find(".add_param").removeClass("selected"),a.find("span").removeClass("unchecked"),a.find("span").removeClass("checked")):(a.find(".icon-param").removeClass("selected"),$(this).addClass("selected"),a.find('input[type="hidden"]').val("Y"),"SPAN"==$(this)[0].tagName&&a.find(".add_param").addClass("selected"),$(this).hasClass("remove-param")?(a.find('input[type="hidden"]').val("E"),a.find("span").removeClass("checked"),a.find("span").addClass("unchecked")):(a.find('input[type="hidden"]').val("Y"),a.find("span").removeClass("unchecked"),a.find("span").addClass("checked"))),smartFilter.click(a.find('input[type="hidden"]')[0]),!1}),$(".apply-filter").on("click",function(e){$(".clear-filter-btn").show(),$(".ingridients-filter-btn").addClass("active")}),$(".clear-filter-btn,.clear-filter").on("click",function(e){$(".clear-filter-btn").hide(),$(".ingridients-filter-btn").removeClass("active"),$(".icon-param").removeClass("selected"),$(".unchecked").removeClass("unchecked"),$(".checked").removeClass("checked")})),$(".gift-item").length&&$(".get-gift").on("click",function(e){$(this).closest(".gift-list").find(".gift-item").removeClass("active"),$(this).closest(".gift-item").addClass("active")}),$(".base-item").length&&$(".base-item").on("click",function(e){$(this).closest(".items-list").find(".base-item").removeClass("active"),$(this).addClass("active")}),$(".delivery-type-toggle").length>0&&$(".delivery-type-toggle a").on("click",function(e){e.preventDefault(),$(".delivery-type-toggle a").removeClass("active"),$('[name="ORDER[DELIVERY_TYPE]"]').val($(this).data("type")),$(this).addClass("active"),$(".delivery-type-content > div").hide(),$(".delivery-type-tab-"+$(this).data("type")).show(),$.ajax({type:"post",data:{TYPE:$(this).data("type")},dataType:"json",url:"/bitrix/components/bd/checkout/component.php?action=checkPickupDiscount",success:function(e){renderBasket()}})}),$(".delivery-time-type-toggle").length>0&&$(".delivery-time-type-toggle a").on("click",function(e){e.preventDefault(),$(".delivery-time-type-toggle a").removeClass("active"),$(this).addClass("active"),2==$(this).data("type")?$(".delivery-time-cont").show():$(".delivery-time-cont").hide()}),$(".bd-row-checkbox").length&&$(".bd-row-checkbox").on("click",function(e){$(this).hasClass("multi")||$(this).closest(".checkboxes-mobile").find(".bd-row-checkbox").removeClass("active"),$(this).hasClass("active")?($('input[name="'+$(this).data("target")+'"]').val(0),$(this).removeClass("active")):($('input[name="'+$(this).data("target")+'"]').val(1),$(this).addClass("active"))}),$(".address-item").on("click",function(e){if($(".status-bar .title").text($(this).data("target-title")),!$(this).hasClass("dis")){e.preventDefault();var t=$(this);return $.ajax({type:"get",data:{ID:t.attr("data-id")},dataType:"json",url:"/?action=getAddress",success:function(e){var t=$(".profile-view.address-view");t.find('input[name="ADDRESS[ID]"]').val(e.ID),t.find('input[name="ADDRESS[NAME]"]').val(e.NAME),t.find('input[name="ADDRESS[STREET]"]').val(e.STREET),t.find('input[name="ADDRESS[HOUSE]"]').val(e.HOUSE),t.find('input[name="ADDRESS[APARTMENT]"]').val(e.APARTMENT),t.find('[name="ADDRESS[DISTRICT_ID]"]').val(e.DISTRICT_ID),$(".address-view .dis").text($('.bd-row-checkbox[data-id="'+e.DISTRICT_ID+'"]').text()),$('.bd-row-checkbox[data-id="'+e.DISTRICT_ID+'"]').addClass("active"),$(".profile-view.personal-view").hide(),$(".profile-view.address-view").show(),$(".status-bar .back").attr("onclick",'getProfileView("personal")')}}),!1}}),$(".districts-view .bd-row-checkbox").on("click",function(e){$('.address-view [name="ADDRESS[DISTRICT_ID]"]').val($(this).attr("data-id")),$(".address-view .dis").text($(this).text()),$(".back:visible").trigger("click"),validateOrder()}),$(".set-pickup-view .bd-row-checkbox").on("click",function(e){e.preventDefault(),$('[name="ORDER[DELIVERY_PICKUP_ID]"]').val($(this).attr("data-id")),$(".delivery-type-tab-2 .config-item a").text($(this).text()),$(".map-row").show(),myMap.setCenter(window["myPlacemark_"+$(this).attr("data-id")].geometry.getCoordinates(),16,{duration:1e3}),validateOrder()}),$(".delivery-regions-view .bd-row-checkbox").on("click",function(e){e.preventDefault(),$(".delivery-regions-view .bd-row-checkbox").removeClass("active"),$(this).addClass("active"),$('.new-address-view [name="ORDER[DISTRICT_ID]"]').val($(this).attr("data-id")),$(".new-address-view .config-item a").text($(this).text()),$.ajax({type:"post",data:{ID:$(".delivery-regions-view .bd-row-checkbox.active").attr("data-id")},dataType:"json",url:"/bitrix/components/bd/checkout/component.php?action=calculateDelivery",success:function(e){$(".delivery-price").show(),$(".fields-group.delivery-price").show(),e.DELIVERY_PRICE>0?($("._delivery-price-value").text(e.DELIVERY_PRICE),$("._with-price").show(),$("._without-price").hide(),$(".delivery-price  .progress-container").show(),$(".delivery-price .progress-container .progress-bar").css("width",e.BASKET_SUM/e.FREE_DELIVERY*100+"%"),$(".delivery-price .progress-container .progress-bar-content").find("span").first().text(e.FREE_DELIVERY-e.BASKET_SUM)):($(".delivery-price  .progress-container").hide(),$("._with-price").hide(),$("._without-price").show()),renderBasket(),$(".back:visible").trigger("click"),validateOrder(),validateAddress()}})}),$(".order-date-view .bd-row-checkbox").on("click",function(e){$(".delivery-time-cont .config-item a").text($(this).text()),$(".back:visible").trigger("click"),validateOrder()}),$(".payment-type-view .bd-row-checkbox").on("click",function(e){e.preventDefault(),$('[name="ORDER[PAYMENT_TYPE]"]').val($(this).attr("data-id")),$(".payment-type-ci a").text($(this).text()),$('[name="ORDER[PAY_IDENT]"]').val($(this).data("type")),"Y"==$(this).data("change")?$("._change_row").show():$("._change_row").hide(),"offline"==$(this).data("type")?$(".send-order").text(BX.message("submit_order")):$(".send-order").text(BX.message("pay_order")),$(".back:visible").trigger("click"),validateOrder()}),$('input[name="ORDER[DISCOUNT_BONUSES]"]').length&&$('input[name="ORDER[DISCOUNT_BONUSES]"]').on("change",function(){var e=$(this);$.ajax({type:"post",data:{AMOUNT:e.val()},dataType:"json",url:"/bitrix/components/bd/checkout/component.php?action=calculateBonuses",success:function(e){0!=e.status&&$('input[name="ORDER[DISCOUNT_BONUSES]"]').val(e.status),renderBasket()}})}),$("#checkout-form").on("submit",function(e){var t=$(this);e.preventDefault(),$.ajax({type:"post",data:t.serialize(),dataType:"json",url:"/bitrix/components/bd/checkout/component.php?action=validate",success:function(e){0==e.status?($(".bd-input,.sod_select").removeClass("error shake"),$(".config-item").removeClass("error"),$(".bd-input").removeClass("error"),$.each(e.errors,function(e,t){"DISTRICT_ID"!=t&&"STREET"!=t&&"HOUSE"!=t&&"APARTMENT"!=t||$(".delivery-type-tab-1 .config-item").last().addClass("error"),"PAYMENT_TYPE"==t&&$(".payment-type-ci").addClass("error"),"DELIVERY_PICKUP_ID"==t&&$(".delivery-type-tab-2 .config-item").addClass("error"),"USER_NAME"==t&&$('[name="ORDER[USER_NAME]"').parent().addClass("error"),"USER_PHONE"==t&&$('[name="ORDER[USER_PHONE]"').parent().addClass("error")})):(void 0!=window.yaCounter&&null!=window.yaCounter&&yaCounter.reachGoal("order-submit",{}),void 0!=ga&&ga("send","event","order","submit"),t[0].submit())}})}),$(".ingredient-list-view .bd-row-checkbox").on("click",function(e){$(this).hasClass("active")?0==$('input[name="INGREDIENTS[]"][value="'+$(this).data("id")+'"]').length&&$("#constructor_form").append('<input type="hidden" name="INGREDIENTS[]" value="'+$(this).data("id")+'"/>'):removeFromConstructor($(this).data("id")),calculateConstructor()}),$(".add-ingredient-view .config-item a").on("click",function(e){$(".ingredient-list-view .bd-row-checkbox").hide(),$('.ingredient-list-view .bd-row-checkbox[data-section="'+$(this).data("id")+'"]').show(),$(".status-bar .title").text($(this).text()),$(".back").attr("onclick","getConstructorView('add-ingredient')")}),$(".my-adresses-view .bd-row-checkbox").on("click",function(e){e.preventDefault(),$('[name="ORDER[DISTRICT_ID]"]').val($(this).data("district")),$('.delivery-regions-view .bd-row-checkbox[data-id="'+$(this).data("district")+'"]').trigger("click"),$(this).data("street").length&&$('[name="ORDER[STREET]"]').val($(this).data("street")),$(this).data("house").toString().length&&$('[name="ORDER[HOUSE]"]').val($(this).data("house")),$(this).data("apartment").toString().length&&$('[name="ORDER[APARTMENT]"]').val($(this).data("apartment")),$(".delivery-type-tab-1 .config-item a").text($(this).data("street")+BX.message("homee")+$(this).data("house")+BX.message("appartaments")+$(this).data("apartment")),$(".checkout-view.new-address-view button").removeAttr("disabled")}),$(".presets-view .base-item").on("click",function(){$('input[name="INGREDIENTS[]"]').remove(),$('#constructor_form input[name="NAME"]').val($(this).find(".name").text()),$('#constructor_form input[name="IMAGE"]').val($(this).data("big-image")),$(".constructor-ingredient-basket-item").remove(),$(this).closest(".select-preset-list").find(".preset-item").removeClass("active"),$(this).addClass("active"),$(".constructor-main-image img").attr("src",$(this).data("big-image"));var e=$(this).data("filling").split(",");$.each(e,function(e,t){$('.ingredient-item[data-id="'+t+'"]').addClass("active"),0==$('input[name="INGREDIENTS[]"][value="'+t+'"]').length&&$("#constructor_form").append('<input type="hidden" name="INGREDIENTS[]" value="'+t+'"/>')}),$('[data-var-name="'+$(this).attr("data-var")+'"]').text($(this).find(".name").text()),calculateConstructor()}),$(".constructor-view.base-view .base-item,.constructor-view.souse-view .base-item").on("click",function(){$('[name="'+$(this).data("target")+'"]').val($(this).data("id")),$('[data-var-name="'+$(this).attr("data-var")+'"]').text($(this).find(".name").text()),calculateConstructor()}),$(".save-address").on("click",function(e){return e.preventDefault(),$.ajax({type:"post",data:$(".address-view form").serialize(),dataType:"json",url:"/?action=updateAddress",success:function(e){window.location.reload()}}),!1}),$(".get-gift").length&&($(".get-gift").on("click",function(e){e.preventDefault();var t=$(this).closest(".gift-item");$(this).hasClass("get-another-gift")?$.ajax({type:"post",data:{PRODUCT_ID:t.data("id"),IS_GIFT:1},dataType:"json",url:"/bitrix/components/bd/basket/component.php?action=removeGift",success:function(e){renderBasket(),void 0!=e.basket_sum&&(t.removeClass("active"),$(".gift-item").removeClass("masked"),$(".get-gift").removeClass("get-another-gift").text(BX.message("choise")))}}):$.ajax({type:"post",data:{PRODUCT_ID:t.data("id"),IS_GIFT:1,GIFT_LIMIT:t.data("limit")},dataType:"json",url:"/bitrix/components/bd/basket/component.php?action=addToBasket",success:function(e){renderBasket(),void 0!=e.basket_sum?(t.addClass("active"),$(".gift-item").addClass("masked"),$('.gift-item[data-id="'+t.data("id")+'"]').removeClass("masked"),t.find("button").addClass("get-another-gift").text(BX.message("get_another_clear"))):alert(BX.message("good_luck_bitch")),$(".gift-progress-complete").addClass("reuse")}})}),$(".get-another-gift").on("click",function(e){e.preventDefault();var t=$(this).closest(".gift-item");$(this).hasClass("get-another-gift"),$(".gift-progress-complete").removeClass("reuse")}))}),function(){var ajaxPagerLoadingClass="ajax-pager-loading",ajaxPagerWrapClass="ajax-pager-wrap",ajaxPagerLinkClass="ajax-pager-link",ajaxWrapAttribute="wrapper-class",ajaxPagerLoadingTpl=['<span class="'+ajaxPagerLoadingClass+'">',"","</span>"].join(""),busy=!1,attachPagination=function(e){var t=$("."+e),a=$(window);t.length&&$("."+ajaxPagerWrapClass).length&&a.on("scroll",function(){a.scrollTop()+a.height()>t.offset().top+t.height()-400&&!busy&&(busy=!0,$("."+ajaxPagerLinkClass).click())})},ajaxPagination=function(e){e.preventDefault(),busy=!0;var wrapperClass=$("."+ajaxPagerLinkClass).data(ajaxWrapAttribute),$wrapper=$("."+wrapperClass),$link=$(this);$wrapper.length&&($("."+ajaxPagerWrapClass).append(ajaxPagerLoadingTpl),$.get($link.attr("href"),{AJAX_PAGE:"Y"},function(data){$("."+ajaxPagerWrapClass).remove(),$wrapper.append($(data).filter(".product-ajax-cont")),$wrapper.append($(data).find(".product-ajax-cont")),$wrapper.append($(data).filter(".news-item")),$wrapper.append($(data).find(".news-item")),$wrapper.append($(data).filter(".ajax-pager-wrap")),$wrapper.append($(data).find(".ajax-pager-wrap")),setTimeout(function(){$wrapper.find(".product-ajax-cont").removeClass("animate")},1e3),setTimeout(function(){var t_=data.split("</html>");if(void 0!==t_[1]&&null!==t_[1]&&void 0!==$(t_[1]).html()){var script=$(t_[1]).html().replace(new RegExp("%26AJAX_PAGE%3DY","g"),"");script=script.replace(new RegExp("&AJAX_PAGE%3DY","g"),""),script=script.replace(new RegExp("PAGEN_[0-9][0-9]%3D[0-9]","g"),""),script=script.replace(new RegExp("PAGEN_[0-9]%3D[0-9]","g"),""),eval(script)}},1e3),attachPagination(wrapperClass),registerProductListeners(),registerLikes(),$("select").selectOrDie({placeholderOption:!0}),busy=!1}))};$(function(){$("."+ajaxPagerLinkClass).length&&$("."+ajaxPagerLinkClass).data(ajaxWrapAttribute).length&&(attachPagination($("."+ajaxPagerLinkClass).data(ajaxWrapAttribute)),$(document).on("click","."+ajaxPagerLinkClass,ajaxPagination))}),$(".accordion__item__head").click(function(){return $(this).parent().toggleClass("open close"),!1})}();